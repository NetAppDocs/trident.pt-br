---
sidebar: sidebar 
permalink: trident-get-started/kubernetes-customize-deploy.html 
keywords: deploy, trident, methods, operator, tridentctl, helm, attributes, customize, tridentorchestrator, smb, windows 
summary: 'O operador Trident permite personalizar a maneira como o Trident é instalado usando os atributos na `TridentOrchestrator` especificação.' 
---
= Personalizar a instalação do operador Trident
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
O operador Trident permite personalizar a instalação do Trident usando os atributos na `TridentOrchestrator` especificação. Se você quiser personalizar a instalação além do que `TridentOrchestrator` os argumentos permitem, considere usar `tridentctl` para gerar manifestos YAML personalizados para modificar conforme necessário.



== Compreensão dos pods dos nós e dos pods do controlador

O Trident é executado como um único pod de controlador e um pod de nó em cada nó de trabalho do cluster. O pod do nó deve estar em execução em qualquer host onde você queira potencialmente montar um volume Trident .

Kubernetes link:https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/["seletores de nós"^] e link:https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/["tolerações e taints"^]são usados para restringir um pod a ser executado em um nó específico ou preferencial. Usando o ControllerPlugin e `NodePlugin`o , você pode especificar restrições e substituições.

* O plugin controlador lida com o provisionamento e gerenciamento de volume, como snapshots e redimensionamento.
* O plug-in do nó manipula a conexão do armazenamento ao nó.




== Opções de configuração


WARNING: `spec.namespace` É especificado em `TridentOrchestrator` para indicar o namespace onde o Trident está instalado. Este parâmetro *não pode ser atualizado após a instalação do Trident*. Tentar fazê-lo faz com que o `TridentOrchestrator` status mude para `Failed`. O Trident não se destina a ser migrado entre namespaces.

Esta tabela detalha `TridentOrchestrator` atributos.

[cols="1,2,1"]
|===
| Parâmetro | Descrição | Padrão 


| `namespace` | Namespace para instalar o Trident em | `"default"` 


| `debug` | Ativar depuração para Trident | `false` 


| `enableForceDetach` | `ontap-san`, `ontap-san-economy` , `ontap-nas` , e `ontap-nas-economy` apenas. Funciona com o recurso Non-Graceful Node Shutdown (NGNS) do Kubernetes para permitir que os administradores do cluster migrem cargas de trabalho com volumes montados para novos nós com segurança, caso um nó apresente problemas. Para obter informações, consultelink:../trident-reco/force-detach.html["Automatizando o failover de aplicações com estado usando o Trident."] . | `false` 


| `windows` | A configuração para `true` permite a instalação em nós de trabalho do Windows. | `false` 


| `cloudProvider`  a| 
Defina como `"Azure"` quando utilizar identidades geridas ou uma identidade de nuvem num cluster AKS. Defina como `"AWS"` ao usar uma identidade de nuvem em um cluster EKS. Defina como `"GCP"` quando estiver usando uma identidade de nuvem em um cluster GKE.
| `""` 


| `cloudIdentity`  a| 
Defina como identidade da carga de trabalho ("azure.Workload.identity/client-id: xxxxxxxx-xxxx-xxxx-xxxxxxxxx") ao usar identidade da nuvem em um cluster AKS. Definido como função do AWS IAM ("'eks.amazonaws.com/role-arn: arn:aws:iam::123456:role/Trident-role'") ao usar a identidade da nuvem em um cluster do EKS. Defina como identidade de nuvem ("'iam.gke.io/gcp-service-account: xxxx@mygcpproject.iam.gserviceaccount.com'") ao usar identidade de nuvem em um cluster GKE.
| `""` 


| `IPv6` | Instale o Trident em IPv6 | falso 


| `k8sTimeout`  a| 
Tempo limite para operações do Kubernetes.


NOTE: O `k8sTimeout` O parâmetro é aplicável somente para instalação do Trident .
| `180sec` 


| `silenceAutosupport` | Não envie pacotes AutoSupport para o NetApp automaticamente | `false` 


| `autosupportImage` | A imagem do recipiente para a telemetria AutoSupport | `"netapp/trident-autosupport10"` 


| `autosupportProxy` | O endereço/porta de um proxy para o envio de telemetria AutoSupport | `"http://proxy.example.com:8888"` 


| `uninstall` | Um sinalizador usado para desinstalar o Trident | `false` 


| `logFormat` | Formato de Registro Trident a ser usado [text,json] | `"text"` 


| `tridentImage` | Imagem Trident a instalar | `"netapp/trident:25.10"` 


| `imageRegistry` | Caminho para o Registro interno, do formato
`<registry FQDN>[:port][/subpath]` | `"registry.k8s.io"` 


| `kubeletDir` | Caminho para o diretório kubelet no host | `"/var/lib/kubelet"` 


| `wipeout` | Uma lista de recursos a serem excluídos para realizar uma remoção completa do Trident |  


| `imagePullSecrets` | Segredos para extrair imagens de um Registro interno |  


| `imagePullPolicy` | Define a política de recebimento de imagens para o operador Trident. Os valores válidos são: 
`Always` Para sempre puxar a imagem. 
`IfNotPresent` para puxar a imagem apenas se ela ainda não existir no nó. 
`Never` para nunca puxar a imagem. | `IfNotPresent` 


| `controllerPluginNodeSelector` | Seletores de nós adicionais para pods. Segue o mesmo formato que `pod.spec.nodeSelector`. | Sem padrão; opcional 


| `controllerPluginTolerations` | Substitui as tolerâncias do Kubernetes para pods. Segue o mesmo formato que `pod.spec.Tolerations`. | Sem padrão; opcional 


| `nodePluginNodeSelector` | Seletores de nós adicionais para pods. Segue o mesmo formato que `pod.spec.nodeSelector`. | Sem padrão; opcional 


| `nodePluginTolerations` | Substitui as tolerâncias do Kubernetes para pods. Segue o mesmo formato que `pod.spec.Tolerations`. | Sem padrão; opcional 


| `nodePrep`  a| 
Permite que o Trident prepare os nós do cluster do Kubernetes para gerenciar volumes usando o protocolo de storage de dados especificado. *Atualmente, `iscsi` é o único valor suportado.*


NOTE: A partir do OpenShift 4.19, a versão mínima do Trident suportada para esse recurso é 25.06.1.
|  


| `k8sAPIQPS`  a| 
O limite de consultas por segundo (QPS) usado pelo controlador durante a comunicação com o servidor da API do Kubernetes.  O valor de Burst é definido automaticamente com base no valor QPS.
| `100`; opcional 


| `enableConcurrency`  a| 
Permite operações simultâneas do controlador Trident para melhor rendimento.


NOTE: *Prévia Técnica*: Este recurso é experimental e atualmente suporta fluxos de trabalho paralelos limitados com os drivers ONTAP-NAS (somente NFS) e ONTAP-SAN (NVMe para ONTAP 9 unificado), além da prévia técnica existente para o driver ONTAP-SAN (protocolos iSCSI e FCP no ONTAP 9 unificado).
| falso 
|===

NOTE: Para obter mais informações sobre a formatação dos parâmetros do pod, link:https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/["Atribuindo pods a nós"^]consulte .

[WARNING]
====
* NÃO altere os nomes de nenhum contêiner ou campo.
* NÃO altere o recuo - o recuo do YAML é fundamental para a análise correta.


====
[NOTE]
====
* Por padrão, não há limites aplicados; apenas as solicitações possuem valores padrão e são aplicadas automaticamente caso não sejam especificadas.
* Os nomes dos contêineres são listados conforme aparecem nas especificações do pod.
* Os sidecars estão listados abaixo de cada contêiner principal.
* Verifique o TORC. `status.CurrentInstallationParams` Campo para visualizar os valores atualmente aplicados.


====
a|

[source, yaml]
----
resources:
  controller:
    trident-main:
      requests:
        cpu: 10m
        memory: 80Mi
      limits:
          cpu:
          memory:
    csi-provisioner:
      requests:
        cpu: 2m
        memory: 20Mi
      limits:
        cpu:
        memory:
    csi-attacher:
      requests:
        cpu: 2m
        memory: 20Mi
      limits:
        cpu:
        memory:
    csi-resizer:
      requests:
        cpu: 3m
        memory: 20Mi
      limits:
        cpu:
        memory:
    csi-snapshotter:
      requests:
        cpu: 2m
        memory: 20Mi
      limits:
        cpu:
        memory:
    trident-autosupport:
      requests:
        cpu: 1m
        memory: 30Mi
      limits:
        cpu:
        memory:
  node:
    linux:
      trident-main:
        requests:
          cpu: 10m
          memory: 60Mi
        limits:
          cpu:
          memory:
      node-driver-registrar:
        requests:
          cpu: 1m
          memory: 10Mi
        limits:
          cpu:
          memory:
    windows:
      trident-main:
        requests:
          cpu: 6m
          memory: 40Mi
        limits:
          cpu:
          memory:
      node-driver-registrar:
        requests:
          cpu: 6m
          memory: 40Mi
        limits:
          cpu:
          memory:
      liveness-probe:
        requests:
          cpu: 2m
          memory: 40Mi
        limits:
          cpu:
          memory:
----
|`httpsMetrics`|Habilite o HTTPS para o endpoint de métricas do Prometheus.  |falso|`hostNetwork` a| Habilita a rede do host para o controlador Trident .  Isso é útil quando você deseja separar o tráfego de front-end do tráfego de back-end em uma rede com várias residências.  |falso

|===


| [NOTA] Para obter mais informações sobre a formatação de parâmetros de pod, consultelink:https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/["Atribuindo pods a nós"^] .  == Exemplos de configurações Você pode usar os atributos em<<Opções de configuração>> ao definir `TridentOrchestrator` Para personalizar sua instalação.  Configuração personalizada básica [%collapsible%closed] ==== Este exemplo foi criado após a execução do `cat deploy/crds/tridentorchestrator_cr_imagepullsecrets.yaml` comando, representa uma instalação personalizada básica: [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident imagePullSecrets: - thisisasecret ---- ==== .Seletores de nó [%collapsible%closed] ==== Este exemplo instala o Trident com seletores de nó.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident controllerPluginNodeSelector: nodetype: master nodePluginNodeSelector: storage: netapp ---- ==== Nós de trabalho do Windows [%collapsible%closed] ==== Este exemplo, criado após a execução do `cat deploy/crds/tridentorchestrator_cr.yaml` O comando instala o Trident em um nó de trabalho do Windows.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident windows: true ---- ==== .Identidades gerenciadas em um cluster AKS [%collapsible%closed] ==== Este exemplo instala o Trident para habilitar identidades gerenciadas em um cluster AKS.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident cloudProvider: "Azure" ---- ==== .Identidade na nuvem em um cluster AKS [%collapsible%closed] ==== Este exemplo instala o Trident para uso com uma identidade na nuvem em um cluster AKS.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident cloudProvider: "Azure" cloudIdentity: 'azure.workload.identity/client-id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx' ---- ==== .Identidade na nuvem em um cluster EKS [%collapsible%closed] ==== Este exemplo instala o Trident para uso com uma identidade na nuvem em um cluster AKS.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident cloudProvider: "AWS" cloudIdentity: "'eks.amazonaws.com/role-arn: arn:aws:iam::123456:role/trident-role'" ---- ==== .Identidade na nuvem para GKE [%collapsible%closed] ==== Este exemplo instala o Trident para uso com uma identidade na nuvem em um cluster GKE.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentBackendConfig metadata: name: backend-tbc-gcp-gcnv spec: version: 1 storageDriverName: google-cloud-netapp-volumes projectNumber: '012345678901' network: gcnv-network location: us-west2 serviceLevel: Premium storagePool: pool-premium1 ---- ==== Configuração de solicitações e limites de recursos do Kubernetes para o controlador Trident e pods de nós Linux do Trident [%collapsible%closed] ==== Este exemplo configura as solicitações e limites de recursos do Kubernetes para o controlador Trident e pods de nós Linux do Trident .  AVISO: *Isenção de responsabilidade*: Os valores de solicitação e limite fornecidos neste exemplo são apenas para fins de demonstração.  Ajuste esses valores com base no seu ambiente e nas necessidades da sua carga de trabalho.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident imagePullSecrets: - thisisasecret resources: controller: trident-main: requests: cpu: 10m memory: 80Mi limits: cpu: 200m memory: 256Mi # sidecars csi-provisioner: requests: cpu: 2m memory: 20Mi limits: cpu: 100m memory: 64Mi csi-attacher: requests: cpu: 2m memory: 20Mi limits: cpu: 100m memory: 64Mi csi-resizer: requests: cpu: 3m memory: 20Mi limits: cpu: 100m memory: 64Mi csi-snapshotter: requests: cpu: 2m memory: 20Mi limits: cpu: 100m memória: 64Mi trident-autosupport: solicitações: cpu: 1m memória: 30Mi limites: cpu: 50m memória: 128Mi nó: linux: trident-main: solicitações: cpu: 10m memória: 60Mi limites: cpu: 200m memória: 256Mi # sidecars node-driver-registrar: solicitações: cpu: 1m memória: 10Mi limites: cpu: 50m memória: 32Mi ---- ==== Configuração de solicitações e limites de recursos do Kubernetes para o controlador Trident e pods de nós Trident Windows e Linux [%collapsible%closed] ==== Este exemplo configura as solicitações e limites de recursos do Kubernetes para o controlador Trident e pods de nós Trident Windows e Linux.  AVISO: *Isenção de responsabilidade*: Os valores de solicitação e limite fornecidos neste exemplo são apenas para fins de demonstração.  Ajuste esses valores com base no seu ambiente e nas necessidades da sua carga de trabalho.  [source,yaml] ---- apiVersion: trident.netapp.io/v1 kind: TridentOrchestrator metadata: name: trident spec: debug: true namespace: trident imagePullSecrets: - thisisasecret windows: true resources: controller: trident-main: requests: cpu: 10m memory: 80Mi limits: cpu: 200m memória: 256Mi # sidecars csi-provisioner: solicitações: cpu: 2m memória: 20Mi limites: cpu: 100m memória: 64Mi csi-attacher: solicitações: cpu: 2m memória: 20Mi limites: cpu: 100m memória: 64Mi csi-resizer: solicitações: cpu: 3m memória: 20Mi limites: cpu: 100m memória: 64Mi csi-snapshotter: solicitações: cpu: 2m memória: 20Mi limites: cpu: 100m memória: 64Mi trident-autosupport: solicitações: cpu: 1m memória: 30Mi limites: cpu: 50m memória: 128Mi node: linux: trident-main: solicitações: cpu: 10m memória: 60Mi limites: cpu: 200m memória: 256Mi # sidecars node-driver-registrar: solicitações: cpu: 1m memória: 10Mi limites: cpu: 50m memória: 32Mi windows: trident-main: solicitações: cpu: 6m memória: 40Mi limites: cpu: 200m memória: 128Mi # sidecars node-driver-registrar: solicitações: cpu: 6m memória: 40Mi limites: cpu: 100m memória: 128Mi liveness-probe: solicitações: cpu: 2m memória: 40Mi limites: cpu: 50m memória: 64Mi ---- ==== 
|===